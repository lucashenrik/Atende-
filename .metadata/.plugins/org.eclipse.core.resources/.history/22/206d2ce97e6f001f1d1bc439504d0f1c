package com.lucas.demo.service;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintWriter;
import java.time.LocalDate;
import java.util.HashMap;
import java.util.Map;

import org.springframework.stereotype.Service;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.lucas.demo.model.Pedido;

@Service
public class ArquivoService {

	public void escreverCodigo(String notificationCode) {

		ObjectMapper mapper = new ObjectMapper();

		Map<String, String> code = new HashMap<>();
		code.put("notificationCode", notificationCode);
		
		LocalDate data = LocalDate.now(); 
		
		// Especifica o caminho onde o arquivo será salvo
	    String diretorio = "C:\\Users\\Lucas\\Documents\\Projetos\\demo\\Registros\\Codigos-de-notificacao";
	    String caminhoArq = diretorio + "\\notificacaoCode_" + data + ".json"; 

	    // Cria o diretório se ele não existir
	    File directory = new File(diretorio);
	    if (!directory.exists()) {
	        directory.mkdirs();  // Cria o diretório, incluindo todos os diretórios necessários
	    }

		//try (PrintWriter escrever = new PrintWriter(new FileWriter("notificationCode"+ data +".json"))) {
		try (PrintWriter escrever = new PrintWriter(new FileWriter(caminhoArq))) {
			// Converter o Map para JSON e escrever no arquivo
			String json = mapper.writeValueAsString(code);

			escrever.println(json);

			//String url = "https://ws.pagseguro.uol.com.br/v3/transactions/notifications/" + notificationCode
					//+ "?{{credenciais}}";

			//return url;
		} catch (IOException e) {
			e.printStackTrace();
			//return ("ALANJKKS");
		}

	}
	
	public void escreverPedido(Pedido pedido) {

		ObjectMapper mapper = new ObjectMapper();

		int id = pedido.getId();
		int quantity = pedido.getQuantity();
		String description = pedido.getDescription();
		
		Map<String, String> data = new HashMap<>();
		data.put("id", String.valueOf(id)); 
		data.put("quantity", String.valueOf(quantity));
		data.put("description", description);

		try {
			 // Escreve o Map no arquivo JSON
            mapper.writeValue(new File("pedido.json"), data);
            System.out.println("Pedido salvo em formato JSON com sucesso.");
        } catch (IOException e) {
            e.printStackTrace();
            System.out.println("Erro ao salvar o pedido em formato JSON.");
        }
    }
}
