package com.lucas.demo.service;

import java.io.File;
import java.io.IOException;
import java.util.List;

import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.stereotype.Service;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.lucas.demo.model.User;
import com.lucas.demo.model.UserData;

import infra.PasswordUtil;

@Service
public class AuthService {

	/*PasswordUtil passwordUtil;

	String caminho = "C:\\Users\\Lucas\\Documents\\Projetos\\demo\\user.json";
	// private static final String USERS_FILE = "user.json";

	
	
	public boolean autenticacao(String username, String password) {
        try {
            ObjectMapper objectMapper = new ObjectMapper();
            UserData userData = objectMapper.readValue(new File(caminho), UserData.class);
            List<User> users = userData.getUsers();

            // Verifica se o username e a senha correspondem
            for (User user : users) {
                if (user.getUsername().equals(username) && user.getPassword().equals(password)) {
                    return true; // Login bem-sucedido
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        return false; // Login falhou
    }*/
	
	
	//private final PasswordUtil passwordUtil;
	private final ObjectMapper objectMapper;
	private final String caminho = "C:\\Users\\Lucas\\Documents\\Projetos\\demo\\user.json";
	private final BCryptPasswordEncoder encoder;

	public AuthService() {
		this.objectMapper = new ObjectMapper();
		this.encoder = new BCryptPasswordEncoder();
	}
	
	public boolean autenticacao(String username, String password) {
		try {
			UserData userData = objectMapper.readValue(new File(caminho), UserData.class);
			List<User> users = userData.getUsers();

			for (User user : users) {
				if (user.getUsername().equals(username)) {
					// Aqui vocÃª deve usar o encoder.matches para comparar a senha fornecida com a senha armazenada
					if (encoder.matches(password, user.getPassword())) {
						System.out.println("Login sucesso!"); // Mensagem de sucesso
						return true;
					}
				}
			}
		} catch (IOException e) {
			e.printStackTrace();
		}
		return false;
	}
}
