package com.lucas.controllers.copy;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

import com.fasterxml.jackson.databind.ObjectMapper;

@RestController
@RequestMapping("/pedido")
public class PedidoControler {

	private final RestTemplate restTemplate = new RestTemplate();

	private ObjectMapper objectMapper = new ObjectMapper();

	@PostMapping("/notificationCode")
	public ResponseEntity<?> getCodigo(@RequestParam String notificationCode, @RequestParam String notificationType) {

		try {
			// Processa os parâmetros recebidos
			String responseMessage = String.format("NotificationCode: %s, NotificationType: %s", notificationCode,
					notificationType);
			return new ResponseEntity<>(responseMessage, HttpStatus.OK);

		} catch (Exception e) {
			e.printStackTrace();
			return new ResponseEntity<>(HttpStatus.INTERNAL_SERVER_ERROR);

		}
	}

	@GetMapping("/consultar")
	public ResponseEntity<?> consultarNotificacao(@RequestParam String notificationCode) {
		String url = "https://ws.pagseguro.uol.com.br/v3/transactions/notifications/{{codigo-notificacao}}?{{credenciais}}"
				+ notificationCode;

		try {

			// Realiza a requisicao GET
			ResponseEntity<String> response = restTemplate.getForEntity(url, String.class);

			return ResponseEntity.ok(response.getBody());
		} catch (Exception e) {
			e.printStackTrace();
			return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body("Erro ao consultar notificação.");
		}
	}
}
