package com.lucas.demo.service;

import java.io.File;
import java.io.IOException;
import java.util.List;

import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.stereotype.Service;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.lucas.demo.model.User;
import com.lucas.demo.model.UserData;

@Service
public class AuthService {

	String caminho = "C:\\Users\\Lucas\\Documents\\Projetos\\demo\\user.json";
	//private static final String USERS_FILE = "user.json";
	
	public boolean autenticacao(String username, String password) {
		try {
			  ObjectMapper objectMapper = new ObjectMapper();
	            UserData userData = objectMapper.readValue(new File(caminho), UserData.class);
	            List<User> users = userData.getUsers();

	            BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();
	            String encodedPassword = encoder.encode(password);
	            System.out.println(encodedPassword);  // Exibe a senha codificada
	            
	            for (User user : users) {
	                if (user.getUsername().equals(username) && encoder.matches(password, user.getPassword())) {
	                    return true;
	                }
	            }
	        } catch (IOException e) {
	            e.printStackTrace();
	        }
	        return false;
	    }
}

